import{d as Q,P as F,M as b,S as E,T as B,R as j,U as N,V as M,W as $,Q as J,a as k,b as m}from"./storage-4cf6cc6a.js";import{N as Y,u as _,b as I,c as C}from"./task-250aa9c6.js";import{f as h,d as ee,N as te,c as oe,o as S,G as A,g as c,e as ne,j as g,t as ae,u as r,k as x}from"./index-710f2f9d.js";import{i as se,a as ie,J as z}from"./file_type-8c8ae3ad.js";const H=({title:t="批量分享链接",content:e=""})=>{Q.success({title:t,style:{width:"800px"},content(){return h(Y,{type:"textarea",autosize:{minRows:8,maxRows:16},inputProps:{style:"white-space: nowrap;"},value:e},null)},positiveText:"复制",onPositiveClick(){return navigator.clipboard.writeText(e).then(()=>{F.success("复制成功")}).catch(()=>{F.success("复制失败")}),!1}})};var V={exports:{}};(function(t,e){(function(s,i){i()})(b,function(){function s(o,n){return typeof n>"u"?n={autoBom:!1}:typeof n!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),n={autoBom:!n}),n.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(o.type)?new Blob(["\uFEFF",o],{type:o.type}):o}function i(o,n,f){var a=new XMLHttpRequest;a.open("GET",o),a.responseType="blob",a.onload=function(){w(a.response,n,f)},a.onerror=function(){console.error("could not download file")},a.send()}function d(o){var n=new XMLHttpRequest;n.open("HEAD",o,!1);try{n.send()}catch{}return 200<=n.status&&299>=n.status}function u(o){try{o.dispatchEvent(new MouseEvent("click"))}catch{var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),o.dispatchEvent(n)}}var l=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof b=="object"&&b.global===b?b:void 0,y=l.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),w=l.saveAs||(typeof window!="object"||window!==l?function(){}:"download"in HTMLAnchorElement.prototype&&!y?function(o,n,f){var a=l.URL||l.webkitURL,p=document.createElement("a");n=n||o.name||"download",p.download=n,p.rel="noopener",typeof o=="string"?(p.href=o,p.origin===location.origin?u(p):d(p.href)?i(o,n,f):u(p,p.target="_blank")):(p.href=a.createObjectURL(o),setTimeout(function(){a.revokeObjectURL(p.href)},4e4),setTimeout(function(){u(p)},0))}:"msSaveOrOpenBlob"in navigator?function(o,n,f){if(n=n||o.name||"download",typeof o!="string")navigator.msSaveOrOpenBlob(s(o,f),n);else if(d(o))i(o,n,f);else{var a=document.createElement("a");a.href=o,a.target="_blank",setTimeout(function(){u(a)})}}:function(o,n,f,a){if(a=a||open("","_blank"),a&&(a.document.title=a.document.body.innerText="downloading..."),typeof o=="string")return i(o,n,f);var p=o.type==="application/octet-stream",K=/constructor/i.test(l.HTMLElement)||l.safari,D=/CriOS\/[\d]+/.test(navigator.userAgent);if((D||p&&K||y)&&typeof FileReader<"u"){var T=new FileReader;T.onloadend=function(){var v=T.result;v=D?v:v.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=v:location=v,a=null},T.readAsDataURL(o)}else{var Z=l.URL||l.webkitURL,P=Z.createObjectURL(o);a?a.location=P:location.href=P,a=null,setTimeout(function(){Z.revokeObjectURL(P)},4e4)}});l.saveAs=w.saveAs=w,t.exports=w})})(V);var R=V.exports;const q="https://github.com/lisonge/lisonge/issues/new",re="280305380",U={origin:"https://github.com",referer:q},ce=async()=>{var d;const t='[data-upload-policy-url="/upload/policies/assets"] input.js-data-upload-policy-url-csrf',e=await E(q);return(d=new DOMParser().parseFromString(await e.text(),"text/html").querySelector(t))==null?void 0:d.getAttribute("value")},G=async(t,e)=>{const[s,i]=(()=>{if(se(t))return[e||"file.png","image/png"];if(ie(t))return[e||"file.zip","application/x-zip-compressed"];throw new Error("invalid bf, it must be png or zip")})(),d=await ce();if(!d)throw new Error("failed get csrfToken");const u=await E("https://github.com/upload/policies/assets",{method:"POST",body:B({authenticity_token:d,content_type:i,name:s,size:t.byteLength,repository_id:re}),headers:U}).then(w=>{if(!w.ok)throw new Error("failed upload policies assets");return w.json()});if(!(await E(u.upload_url,{method:"POST",body:B(u.form,{file:new File([t],s,{type:i})}),headers:U})).ok)throw new Error("upload s3 failed");if((await E(new URL(u.asset_upload_url,"https://github.com/").href,{method:"PUT",body:B({authenticity_token:u.asset_upload_authenticity_token}),headers:{...U,Accept:"application/json"}})).status!=200)throw new Error("failed check authenticity upload");return u.asset},L=async t=>{const e=new z;return e.file("snapshot.json",JSON.stringify(t)).file("screenshot.png",await J.getItem(t.id)),await e.generateAsync({type:"blob",compression:"STORE"})},le=async t=>{const e=`snapshot-${t.id}.zip`;R.saveAs(await L(t),e)},O=async t=>{const e=await J.getItem(t.id);return new Blob([e,JSON.stringify(t)])},pe=async t=>{const e=`snapshot-${t.id}.png`;R.saveAs(await O(t),e)},me=async t=>{const e=new z;for(const i of t)await j(),e.file(i.id+".png",O(i));const s=await e.generateAsync({type:"blob",compression:"STORE"});R.saveAs(s,`batch-png-${t.length}.zip`)},ge=async t=>{const e=new z;for(const i of t)await j(),e.file(i.id+".zip",await L(i));const s=await e.generateAsync({type:"blob",compression:"STORE"});R.saveAs(s,`batch-zip-${t.length}.zip`)},W=async t=>N[t.id]??G(await O(t).then(e=>e.arrayBuffer())).then(e=>(N[t.id]=structuredClone(e),e)),X=async t=>M[t.id]??G(await L(t).then(e=>e.arrayBuffer())).then(e=>(M[t.id]=structuredClone(e),e)),ye=async t=>{const e=$(3);return(await Promise.allSettled(t.map(s=>e(()=>W(s))))).reduce((s,i)=>(i.status=="fulfilled"&&s.push(i.value),s),[])},ve=async t=>{const e=$(3);return(await Promise.allSettled(t.map(s=>e(()=>X(s))))).reduce((s,i)=>(i.status=="fulfilled"&&s.push(i.value),s),[])},ue=["href"],be=ee({__name:"ActionCard",props:{snapshot:{},onDelete:{type:Function,default:()=>()=>{}},showPreview:{type:Boolean,default:!0},showExport:{type:Boolean,default:!0},showDelete:{type:Boolean,default:!0},showShare:{type:Boolean,default:!0}},setup(t){const e=t,s=te(),i=_(async()=>pe(await k.getItem(e.snapshot.id))),d=_(async()=>le(await k.getItem(e.snapshot.id))),u=oe(()=>s.resolve({name:"snapshot",params:{snapshotId:e.snapshot.id}}).href),l=_(async()=>{const o=await W(await k.getItem(e.snapshot.id));H({title:"分享链接",content:o.href+`
`})}),y=_(async()=>{const o=await X(await k.getItem(e.snapshot.id));H({title:"分享链接",content:o.href+`
`})}),w=async()=>{await k.removeItem(e.snapshot.id),await j(500),e.onDelete()};return(o,n)=>(S(),A(r(C),null,{default:c(()=>[o.showPreview?(S(),ne("a",{key:0,target:"_blank",href:u.value},[h(r(m),{size:"small"},{default:c(()=>[g(ae(o.$t("preview")),1)]),_:1})],8,ue)):x("",!0),o.showExport?(S(),A(r(I),{key:1},{trigger:c(()=>[h(r(m),{size:"small"},{default:c(()=>[g(" 下载 ")]),_:1})]),default:c(()=>[h(r(C),{vertical:""},{default:c(()=>[h(r(m),{onClick:r(i).invoke,loading:r(i).loading},{default:c(()=>[g(" 下载-png ")]),_:1},8,["onClick","loading"]),h(r(m),{onClick:r(d).invoke,loading:r(d).loading},{default:c(()=>[g(" 下载-zip ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1})):x("",!0),o.showShare?(S(),A(r(I),{key:2},{trigger:c(()=>[h(r(m),{size:"small"},{default:c(()=>[g(" 分享 ")]),_:1})]),default:c(()=>[h(r(C),{vertical:""},{default:c(()=>[h(r(m),{onClick:r(l).invoke,loading:r(l).loading},{default:c(()=>[g(" 生成链接-png ")]),_:1},8,["onClick","loading"]),h(r(m),{onClick:r(y).invoke,loading:r(y).loading},{default:c(()=>[g(" 生成链接-zip ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1})):x("",!0),o.showDelete?(S(),A(r(m),{key:3,size:"small",onClick:w},{default:c(()=>[g(" 删除 ")]),_:1})):x("",!0)]),_:1}))}});export{be as _,ge as a,me as b,ye as c,ve as d,H as s};
//# sourceMappingURL=ActionCard.vue_vue_type_script_setup_true_lang-008125ff.js.map
