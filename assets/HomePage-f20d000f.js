import{d as G,s as k,a as D,c as W,w as z,r as X,b as l,e as J,f as K,g as o,u as e,h as c,F as T,i as Y,j as O,o as Q,N as M,k as ee,l as ae,m as i,n as s,t as te,p as le,R as oe}from"./index-89bd64bf.js";import{_ as ne,b as ie,a as se,c as re,d as ce}from"./ActionCard.vue_vue_type_script_setup_true_lang-438adfc7.js";import{t as ue}from"./check-44032eaf.js";import{i as de,a as pe}from"./import-d9f27b81.js";import{s as ge,a as B,g as Z}from"./storage-b53c4e07.js";import{u as ve,N as fe,r as we}from"./table-5a687230.js";import{u as d,N as me,a as b,b as v,c as L}from"./task-b0835956.js";import"./file_type-74916a33.js";const he={flex:"","flex-col":"","p-10px":"","gap-10px":"","h-full":""},ke={flex:""},Ce={"h-full":"",flex:"","flex-items-center":""},ye=c("div",{"flex-1":""},null,-1),_e=c("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},[c("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 112v288"}),c("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M400 256H112"})],-1),xe=c("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},[c("path",{d:"M270.1 741.7c0 23.4 19.1 42.5 42.6 42.5h48.7v120.4c0 30.5 24.5 55.4 54.6 55.4c30.2 0 54.6-24.8 54.6-55.4V784.1h85v120.4c0 30.5 24.5 55.4 54.6 55.4c30.2 0 54.6-24.8 54.6-55.4V784.1h48.7c23.5 0 42.6-19.1 42.6-42.5V346.4h-486v395.3zm357.1-600.1l44.9-65c2.6-3.8 2-8.9-1.5-11.4c-3.5-2.4-8.5-1.2-11.1 2.6l-46.6 67.6c-30.7-12.1-64.9-18.8-100.8-18.8c-35.9 0-70.1 6.7-100.8 18.8l-46.6-67.5c-2.6-3.8-7.6-5.1-11.1-2.6c-3.5 2.4-4.1 7.4-1.5 11.4l44.9 65c-71.4 33.2-121.4 96.1-127.8 169.6h486c-6.6-73.6-56.7-136.5-128-169.7zM409.5 244.1a26.9 26.9 0 1 1 26.9-26.9a26.97 26.97 0 0 1-26.9 26.9zm208.4 0a26.9 26.9 0 1 1 26.9-26.9a26.97 26.97 0 0 1-26.9 26.9zm223.4 100.7c-30.2 0-54.6 24.8-54.6 55.4v216.4c0 30.5 24.5 55.4 54.6 55.4c30.2 0 54.6-24.8 54.6-55.4V400.1c.1-30.6-24.3-55.3-54.6-55.3zm-658.6 0c-30.2 0-54.6 24.8-54.6 55.4v216.4c0 30.5 24.5 55.4 54.6 55.4c30.2 0 54.6-24.8 54.6-55.4V400.1c0-30.6-24.5-55.3-54.6-55.3z",fill:"currentColor"})],-1),De=G({__name:"HomePage",setup(Ne){const C=k([]),p=async()=>{C.value=(await ge.getAllItems()).reverse(),r.value=[]};p();const u=D({query:"",actualQuery:"",updateQuery:()=>{u.actualQuery=u.query.trim(),r.value=[]}}),f=W(()=>{const t=u.actualQuery;return t?C.value.filter(a=>a.appName.includes(t)||a.appId.includes(t)||a.activityId.includes(t)):C.value}),P=d(async()=>{await de(),await p()}),{activityIdCol:y,appIdCol:q,appNameCol:_,ctimeCol:x,deviceCol:N,appVersionCodeCol:F,appVersionNameCol:$,reseColWidth:E}=ve();z(()=>{const t=f.value.reduce((a,n)=>(a.add(we(n)),a),new Set);if(t.size<=1){N.filterOptions=void 0;return}N.filterOptions=[...t.values()].map(a=>({value:a,label:a}))}),z(()=>{const t=f.value.reduce((a,n)=>(a.add(n.appName),a),new Set);if(t.size<=1){_.filterOptions=void 0;return}_.filterOptions=[...t.values()].map(a=>({value:a,label:a}))}),z(()=>{const t=f.value.reduce((a,n)=>(a.add(n.activityId),a),new Set);if(t.size<=1){y.filterOptions=void 0;return}y.filterOptions=[...t.values()].map(a=>({value:a,label:a}))});const H=X([{type:"selection"},x,N,_,q,F,$,y,{key:"actions",title:"操作",fixed:"right",width:"255px",render(t){return l(ne,{snapshot:t,onDelete:p},null)}}]),g=D({page:1,pageSize:50,showSizePicker:!0,pageSizes:[50,100],onChange:t=>{g.page=t},onUpdatePageSize:t=>{g.pageSize=t,g.page=1}});J(g,E);const j=t=>{t.columnKey==x.key&&(x.sortOrder=t.order)},S=k(!1),w=k(""),m=d(async()=>{const t=w.value.trim().split(`
`).map(a=>a.trim()).filter(a=>ue(a));t.length!=0&&(await pe(t),await p(),w.value="")}),r=k([]),h=()=>Promise.all(r.value.map(t=>B.getItem(t))),A=d(async()=>{await new Promise((t,a)=>{Y.warning({title:"删除",content:`是否批量删除 ${r.value.length} 个快照`,negativeText:"取消",positiveText:"确认",onClose:a,onEsc:a,onMaskClick:a,onNegativeClick:a,onPositiveClick:t})}),await Promise.all(r.value.map(t=>B.removeItem(t))),await p()}),U=d(async()=>{await ie(await h())}),I=d(async()=>{await se(await h())}),V=d(async()=>{const t=await re(await h());O({content:t.map(a=>Z(a)).join(`
`)+`
`})}),R=d(async()=>{const t=await ce(await h());O({content:t.map(a=>Z(a)).join(`
`)+`
`})});return(t,a)=>(Q(),K(T,null,[l(e(ee),{show:S.value,"onUpdate:show":a[1]||(a[1]=n=>S.value=n),preset:"dialog",title:"导入网络文件",showIcon:!1,positiveText:"确认",negativeText:"取消",style:{width:"800px"},onPositiveClick:e(m).invoke,loading:e(m).loading},{default:o(()=>[l(e(M),{value:w.value,"onUpdate:value":a[0]||(a[0]=n=>{e(m).loading||(w.value=n)}),type:"textarea",placeholder:`请输入文件链接
每行一个
空白行自动忽略
非法链接行自动忽略`,autosize:{minRows:8,maxRows:16},inputProps:{style:"white-space: nowrap;"}},null,8,["value"])]),_:1},8,["show","onPositiveClick","loading"]),c("div",he,[c("div",ke,[l(e(v),null,{default:o(()=>[l(e(me),null,{default:o(()=>[l(e(M),{placeholder:"请输入关键字搜索",clearable:"",value:e(u).query,"onUpdate:value":a[2]||(a[2]=n=>e(u).query=n),onKeyup:ae(e(u).updateQuery,["enter"]),onChange:e(u).updateQuery},null,8,["value","onKeyup","onChange"]),l(e(i),{onClick:e(u).updateQuery},{default:o(()=>[s(" 搜索 ")]),_:1},8,["onClick"])]),_:1}),r.value.length?(Q(),K(T,{key:0},[l(e(b),null,{trigger:o(()=>[l(e(i),null,{default:o(()=>[s(" 批量下载 ")]),_:1})]),default:o(()=>[l(e(v),{vertical:""},{default:o(()=>[l(e(i),{onClick:e(U).invoke,loading:e(U).loading},{default:o(()=>[s(" 批量下载-png ")]),_:1},8,["onClick","loading"]),l(e(i),{onClick:e(I).invoke,loading:e(I).loading},{default:o(()=>[s(" 批量下载-zip ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1}),l(e(b),null,{trigger:o(()=>[l(e(i),null,{default:o(()=>[s(" 批量分享 ")]),_:1})]),default:o(()=>[l(e(v),{vertical:""},{default:o(()=>[l(e(i),{onClick:e(V).invoke,loading:e(V).loading},{default:o(()=>[s(" 批量生成链接-png ")]),_:1},8,["onClick","loading"]),l(e(i),{onClick:e(R).invoke,loading:e(R).loading},{default:o(()=>[s(" 批量生成链接-zip ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1}),l(e(i),{onClick:e(A).invoke},{default:o(()=>[s(" 批量删除 ")]),_:1},8,["onClick"]),c("div",Ce,te(`已选中 ${r.value.length} 个快照`),1)],64)):le("",!0)]),_:1}),ye,l(e(v),null,{default:o(()=>[l(e(b),null,{trigger:o(()=>[l(e(i),null,{icon:o(()=>[l(e(L),null,{default:o(()=>[_e]),_:1})]),_:1})]),default:o(()=>[l(e(v),{vertical:""},{default:o(()=>[l(e(i),{onClick:e(P).invoke,loading:e(P).loading},{default:o(()=>[s(" 导入本地文件 ")]),_:1},8,["onClick","loading"]),l(e(i),{onClick:a[3]||(a[3]=n=>S.value=!0),loading:e(m).loading},{default:o(()=>[s(" 导入网络文件 ")]),_:1},8,["loading"])]),_:1})]),_:1}),l(e(oe),{to:"/device"},{default:o(()=>[l(e(i),null,{icon:o(()=>[l(e(L),null,{default:o(()=>[xe]),_:1})]),_:1})]),_:1})]),_:1})]),l(e(fe),{striped:"",data:f.value,columns:H,scrollX:1800,pagination:e(g),checkedRowKeys:r.value,"onUpdate:checkedRowKeys":a[4]||(a[4]=n=>r.value=n),rowKey:n=>n.id,"onUpdate:sorter":j,size:"small",class:"flex-1",flexHeight:""},null,8,["data","columns","pagination","checkedRowKeys","rowKey"])])],64))}});export{De as default};
//# sourceMappingURL=HomePage-f20d000f.js.map
