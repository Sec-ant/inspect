import{d as G,s as w,a as K,c as W,w as b,r as X,b as l,e as j,f as T,g as o,u as e,h as k,F as O,i as J,j as Q,o as V,N as Z,k as Y,l as ee,m as i,n as s,t as ae,p as te,R as le}from"./index-dedea248.js";import{_ as oe,b as ne,a as ie,c as se,d as re}from"./ActionCard.vue_vue_type_script_setup_true_lang-05f1b9d0.js";import{t as ue}from"./check-44032eaf.js";import{i as de,a as ce}from"./import-fe375a65.js";import{s as pe,a as L,g as q}from"./storage-ba037a15.js";import{u as fe,N as ge,r as ve}from"./table-ae1a8ee1.js";import{u as d,N as me,a as P,b as f}from"./task-2cb3dacc.js";import"./file_type-7205f6eb.js";const he={flex:"","flex-col":"","p-10px":"","gap-10px":"","h-full":""},we={flex:""},ke={"h-full":"",flex:"","flex-items-center":""},ye=k("div",{"flex-1":""},null,-1),Ie=G({__name:"HomePage",setup(Ce){const y=w([]),c=async()=>{y.value=(await pe.getAllItems()).reverse(),r.value=[]};c();const u=K({query:"",actualQuery:"",updateQuery:()=>{u.actualQuery=u.query.trim(),r.value=[]}}),g=W(()=>{const t=u.actualQuery;return t?y.value.filter(a=>a.appName.includes(t)||a.appId.includes(t)||a.activityId.includes(t)):y.value}),U=d(async()=>{await de(),await c()}),{activityIdCol:C,appIdCol:B,appNameCol:_,ctimeCol:x,deviceCol:N,appVersionCodeCol:F,appVersionNameCol:$,reseColWidth:E}=fe();b(()=>{const t=g.value.reduce((a,n)=>(a.add(ve(n)),a),new Set);if(t.size<=1){N.filterOptions=void 0;return}N.filterOptions=[...t.values()].map(a=>({value:a,label:a}))}),b(()=>{const t=g.value.reduce((a,n)=>(a.add(n.appName),a),new Set);if(t.size<=1){_.filterOptions=void 0;return}_.filterOptions=[...t.values()].map(a=>({value:a,label:a}))}),b(()=>{const t=g.value.reduce((a,n)=>(a.add(n.activityId),a),new Set);if(t.size<=1){C.filterOptions=void 0;return}C.filterOptions=[...t.values()].map(a=>({value:a,label:a}))});const M=X([{type:"selection"},x,N,_,B,F,$,C,{key:"actions",title:"操作",fixed:"right",width:"255px",render(t){return l(oe,{snapshot:t,onDelete:c},null)}}]),p=K({page:1,pageSize:50,showSizePicker:!0,pageSizes:[50,100],onChange:t=>{p.page=t},onUpdatePageSize:t=>{p.pageSize=t,p.page=1}});j(p,E);const H=t=>{t.columnKey==x.key&&(x.sortOrder=t.order)},S=w(!1),v=w(""),m=d(async()=>{const t=v.value.trim().split(`
`).map(a=>a.trim()).filter(a=>ue(a));t.length!=0&&(await ce(t),await c(),v.value="")}),r=w([]),h=()=>Promise.all(r.value.map(t=>L.getItem(t))),A=d(async()=>{await new Promise((t,a)=>{J.warning({title:"删除",content:`是否批量删除 ${r.value.length} 个快照`,negativeText:"取消",positiveText:"确认",onClose:a,onEsc:a,onMaskClick:a,onNegativeClick:a,onPositiveClick:t})}),await Promise.all(r.value.map(t=>L.removeItem(t))),await c()}),z=d(async()=>{await ne(await h())}),I=d(async()=>{await ie(await h())}),R=d(async()=>{const t=await se(await h());Q({content:t.map(a=>q(a)).join(`
`)+`
`})}),D=d(async()=>{const t=await re(await h());Q({content:t.map(a=>q(a)).join(`
`)+`
`})});return(t,a)=>(V(),T(O,null,[l(e(Y),{show:S.value,"onUpdate:show":a[1]||(a[1]=n=>S.value=n),preset:"dialog",title:"导入网络文件",showIcon:!1,positiveText:"确认",negativeText:"取消",style:{width:"800px"},onPositiveClick:e(m).invoke,loading:e(m).loading},{default:o(()=>[l(e(Z),{value:v.value,"onUpdate:value":a[0]||(a[0]=n=>{e(m).loading||(v.value=n)}),type:"textarea",placeholder:`请输入文件链接
每行一个
空白行自动忽略
非法链接行自动忽略`,autosize:{minRows:8,maxRows:16},inputProps:{style:"white-space: nowrap;"}},null,8,["value"])]),_:1},8,["show","onPositiveClick","loading"]),k("div",he,[k("div",we,[l(e(f),null,{default:o(()=>[l(e(me),null,{default:o(()=>[l(e(Z),{placeholder:"请输入关键字搜索",clearable:"",value:e(u).query,"onUpdate:value":a[2]||(a[2]=n=>e(u).query=n),onKeyup:ee(e(u).updateQuery,["enter"]),onChange:e(u).updateQuery},null,8,["value","onKeyup","onChange"]),l(e(i),{onClick:e(u).updateQuery},{default:o(()=>[s(" 搜索 ")]),_:1},8,["onClick"])]),_:1}),r.value.length?(V(),T(O,{key:0},[l(e(P),null,{trigger:o(()=>[l(e(i),null,{default:o(()=>[s(" 批量下载 ")]),_:1})]),default:o(()=>[l(e(f),{vertical:""},{default:o(()=>[l(e(i),{onClick:e(z).invoke,loading:e(z).loading},{default:o(()=>[s(" 批量下载-png ")]),_:1},8,["onClick","loading"]),l(e(i),{onClick:e(I).invoke,loading:e(I).loading},{default:o(()=>[s(" 批量下载-zip ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1}),l(e(P),null,{trigger:o(()=>[l(e(i),null,{default:o(()=>[s(" 批量分享 ")]),_:1})]),default:o(()=>[l(e(f),{vertical:""},{default:o(()=>[l(e(i),{onClick:e(R).invoke,loading:e(R).loading},{default:o(()=>[s(" 批量生成链接-png ")]),_:1},8,["onClick","loading"]),l(e(i),{onClick:e(D).invoke,loading:e(D).loading},{default:o(()=>[s(" 批量生成链接-zip ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1}),l(e(i),{onClick:e(A).invoke},{default:o(()=>[s(" 批量删除 ")]),_:1},8,["onClick"]),k("div",ke,ae(`已选中 ${r.value.length} 个快照`),1)],64)):te("",!0)]),_:1}),ye,l(e(f),null,{default:o(()=>[l(e(P),null,{trigger:o(()=>[l(e(i),null,{default:o(()=>[s(" 导入 ")]),_:1})]),default:o(()=>[l(e(f),{vertical:""},{default:o(()=>[l(e(i),{onClick:e(U).invoke,loading:e(U).loading},{default:o(()=>[s(" 导入本地文件 ")]),_:1},8,["onClick","loading"]),l(e(i),{onClick:a[3]||(a[3]=n=>S.value=!0),loading:e(m).loading},{default:o(()=>[s(" 导入网络文件 ")]),_:1},8,["loading"])]),_:1})]),_:1}),l(e(le),{to:"/device"},{default:o(()=>[l(e(i),null,{default:o(()=>[s(" 去连接设备 ")]),_:1})]),_:1})]),_:1})]),l(e(ge),{striped:"",data:g.value,columns:M,scrollX:1800,pagination:e(p),checkedRowKeys:r.value,"onUpdate:checkedRowKeys":a[4]||(a[4]=n=>r.value=n),rowKey:n=>n.id,"onUpdate:sorter":H,size:"small",class:"flex-1",flexHeight:""},null,8,["data","columns","pagination","checkedRowKeys","rowKey"])])],64))}});export{Ie as default};
//# sourceMappingURL=HomePage-9ff3b9f0.js.map
