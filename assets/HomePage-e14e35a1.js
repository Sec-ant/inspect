import{d as H,s as w,a as K,c as G,w as b,r as W,b as l,e as X,f as O,g as o,u as e,h as k,F as Q,i as j,j as T,o as V,N as Z,k as J,l as Y,m as i,n as s,t as ee,p as ae,R as te}from"./index-b1304cf0.js";import{_ as le,b as oe,a as ne,c as ie,d as se}from"./ActionCard.vue_vue_type_script_setup_true_lang-640c2280.js";import{t as re}from"./check-44032eaf.js";import{i as ue,a as de}from"./import-6864256a.js";import{s as ce,a as L}from"./storage-4bb66a1a.js";import{u as pe,N as fe,r as ge}from"./table-f52d9995.js";import{u as d,N as ve,a as P,b as f}from"./task-fc36cfbd.js";import"./file_type-5aef3647.js";const me={flex:"","flex-col":"","p-10px":"","gap-10px":"","h-full":""},he={flex:""},we={"h-full":"",flex:"","flex-items-center":""},ke=k("div",{"flex-1":""},null,-1),Ie=H({__name:"HomePage",setup(ye){const y=w([]),c=async()=>{y.value=(await ce.getAllItems()).reverse(),r.value=[]};c();const u=K({query:"",actualQuery:"",updateQuery:()=>{u.actualQuery=u.query.trim(),r.value=[]}}),g=G(()=>{const t=u.actualQuery;return t?y.value.filter(a=>a.appName.includes(t)||a.appId.includes(t)||a.activityId.includes(t)):y.value}),z=d(async()=>{await ue(),await c()}),{activityIdCol:C,appIdCol:q,appNameCol:_,ctimeCol:x,deviceCol:N,appVersionCodeCol:B,appVersionNameCol:F,reseColWidth:$}=pe();b(()=>{const t=g.value.reduce((a,n)=>(a.add(ge(n)),a),new Set);if(t.size<=1){N.filterOptions=void 0;return}N.filterOptions=[...t.values()].map(a=>({value:a,label:a}))}),b(()=>{const t=g.value.reduce((a,n)=>(a.add(n.appName),a),new Set);if(t.size<=1){_.filterOptions=void 0;return}_.filterOptions=[...t.values()].map(a=>({value:a,label:a}))}),b(()=>{const t=g.value.reduce((a,n)=>(a.add(n.activityId),a),new Set);if(t.size<=1){C.filterOptions=void 0;return}C.filterOptions=[...t.values()].map(a=>({value:a,label:a}))});const A=W([{type:"selection"},x,N,_,q,B,F,C,{key:"actions",title:"操作",fixed:"right",width:"255px",render(t){return l(le,{snapshot:t,onDelete:c},null)}}]),p=K({page:1,pageSize:50,showSizePicker:!0,pageSizes:[50,100],onChange:t=>{p.page=t},onUpdatePageSize:t=>{p.pageSize=t,p.page=1}});X(p,$);const E=t=>{t.columnKey==x.key&&(x.sortOrder=t.order)},S=w(!1),v=w(""),m=d(async()=>{const t=v.value.trim().split(`
`).map(a=>a.trim()).filter(a=>re(a));t.length!=0&&(await de(t),await c(),v.value="")}),r=w([]),h=()=>Promise.all(r.value.map(t=>L.getItem(t))),M=d(async()=>{await new Promise((t,a)=>{j.warning({title:"删除",content:`是否批量删除 ${r.value.length} 个快照`,negativeText:"取消",positiveText:"确认",onClose:a,onEsc:a,onMaskClick:a,onNegativeClick:a,onPositiveClick:t})}),await Promise.all(r.value.map(t=>L.removeItem(t))),await c()}),I=d(async()=>{await oe(await h())}),R=d(async()=>{await ne(await h())}),U=d(async()=>{const t=await ie(await h());T({content:t.map(a=>a.href).join(`
`)+`
`})}),D=d(async()=>{const t=await se(await h());T({content:t.map(a=>a.href).join(`
`)+`
`})});return(t,a)=>(V(),O(Q,null,[l(e(J),{show:S.value,"onUpdate:show":a[1]||(a[1]=n=>S.value=n),preset:"dialog",title:"导入网络文件",showIcon:!1,positiveText:"确认",negativeText:"取消",style:{width:"800px"},onPositiveClick:e(m).invoke,loading:e(m).loading},{default:o(()=>[l(e(Z),{value:v.value,"onUpdate:value":a[0]||(a[0]=n=>{e(m).loading||(v.value=n)}),type:"textarea",placeholder:`请输入文件链接
每行一个
空白行自动忽略
非法链接行自动忽略`,autosize:{minRows:8,maxRows:16},inputProps:{style:"white-space: nowrap;"}},null,8,["value"])]),_:1},8,["show","onPositiveClick","loading"]),k("div",me,[k("div",he,[l(e(f),null,{default:o(()=>[l(e(ve),null,{default:o(()=>[l(e(Z),{placeholder:"请输入关键字搜索",clearable:"",value:e(u).query,"onUpdate:value":a[2]||(a[2]=n=>e(u).query=n),onKeyup:Y(e(u).updateQuery,["enter"]),onChange:e(u).updateQuery},null,8,["value","onKeyup","onChange"]),l(e(i),{onClick:e(u).updateQuery},{default:o(()=>[s(" 搜索 ")]),_:1},8,["onClick"])]),_:1}),r.value.length?(V(),O(Q,{key:0},[l(e(P),null,{trigger:o(()=>[l(e(i),null,{default:o(()=>[s(" 批量下载 ")]),_:1})]),default:o(()=>[l(e(f),{vertical:""},{default:o(()=>[l(e(i),{onClick:e(I).invoke,loading:e(I).loading},{default:o(()=>[s(" 批量下载-png ")]),_:1},8,["onClick","loading"]),l(e(i),{onClick:e(R).invoke,loading:e(R).loading},{default:o(()=>[s(" 批量下载-zip ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1}),l(e(P),null,{trigger:o(()=>[l(e(i),null,{default:o(()=>[s(" 批量分享 ")]),_:1})]),default:o(()=>[l(e(f),{vertical:""},{default:o(()=>[l(e(i),{onClick:e(U).invoke,loading:e(U).loading},{default:o(()=>[s(" 批量生成链接-png ")]),_:1},8,["onClick","loading"]),l(e(i),{onClick:e(D).invoke,loading:e(D).loading},{default:o(()=>[s(" 批量生成链接-zip ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1}),l(e(i),{onClick:e(M).invoke},{default:o(()=>[s(" 批量删除 ")]),_:1},8,["onClick"]),k("div",we,ee(`已选中 ${r.value.length} 个快照`),1)],64)):ae("",!0)]),_:1}),ke,l(e(f),null,{default:o(()=>[l(e(P),null,{trigger:o(()=>[l(e(i),null,{default:o(()=>[s(" 导入 ")]),_:1})]),default:o(()=>[l(e(f),{vertical:""},{default:o(()=>[l(e(i),{onClick:e(z).invoke,loading:e(z).loading},{default:o(()=>[s(" 导入本地文件 ")]),_:1},8,["onClick","loading"]),l(e(i),{onClick:a[3]||(a[3]=n=>S.value=!0),loading:e(m).loading},{default:o(()=>[s(" 导入网络文件 ")]),_:1},8,["loading"])]),_:1})]),_:1}),l(e(te),{to:"/device"},{default:o(()=>[l(e(i),null,{default:o(()=>[s(" 去连接设备 ")]),_:1})]),_:1})]),_:1})]),l(e(fe),{striped:"",data:g.value,columns:A,scrollX:1800,pagination:e(p),checkedRowKeys:r.value,"onUpdate:checkedRowKeys":a[4]||(a[4]=n=>r.value=n),rowKey:n=>n.id,"onUpdate:sorter":E,size:"small",class:"flex-1",flexHeight:""},null,8,["data","columns","pagination","checkedRowKeys","rowKey"])])],64))}});export{Ie as default};
//# sourceMappingURL=HomePage-e14e35a1.js.map
