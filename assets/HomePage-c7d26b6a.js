import{d as G,s as w,a as O,c as H,w as b,r as W,b as j,e as Q,f as l,g as o,u as e,h as k,F as V,o as K,i as J,j as i,t as X,k as Y,R as ee}from"./index-afdef657.js";import{_ as ae,b as te,a as le,c as oe,s as T,d as ne}from"./ActionCard.vue_vue_type_script_setup_true_lang-dd42e639.js";import{t as ie}from"./check-44032eaf.js";import{s as se,d as re,a as Z,N as ue,b as s}from"./storage-bd0a0faa.js";import{i as de,a as ce}from"./import-15082c60.js";import{u as pe,N as fe,r as ge}from"./table-5d29cb6f.js";import{u as d,N as L,a as ve,b as P,c as f}from"./task-d98603b0.js";import"./file_type-dd3bd1e2.js";const me={flex:"","flex-col":"","p-10px":"","gap-10px":"","h-full":""},he={flex:""},we={"h-full":"",flex:"","flex-items-center":""},ke=k("div",{"flex-1":""},null,-1),Ue=G({__name:"HomePage",setup(ye){const y=w([]),c=async()=>{y.value=(await se.getAllItems()).reverse(),r.value=[]};c();const u=O({query:"",actualQuery:"",updateQuery:()=>{u.actualQuery=u.query.trim(),r.value=[]}}),g=H(()=>{const t=u.actualQuery;return t?y.value.filter(a=>a.appName.includes(t)||a.appId.includes(t)||a.activityId.includes(t)):y.value}),z=d(async()=>{await de(),await c()}),{activityIdCol:C,appIdCol:q,appNameCol:_,ctimeCol:x,deviceCol:N,appVersionCodeCol:A,appVersionNameCol:B,reseColWidth:F}=pe();b(()=>{const t=g.value.reduce((a,n)=>(a.add(ge(n)),a),new Set);if(t.size<=1){N.filterOptions=void 0;return}N.filterOptions=[...t.values()].map(a=>({value:a,label:a}))}),b(()=>{const t=g.value.reduce((a,n)=>(a.add(n.appName),a),new Set);if(t.size<=1){_.filterOptions=void 0;return}_.filterOptions=[...t.values()].map(a=>({value:a,label:a}))}),b(()=>{const t=g.value.reduce((a,n)=>(a.add(n.activityId),a),new Set);if(t.size<=1){C.filterOptions=void 0;return}C.filterOptions=[...t.values()].map(a=>({value:a,label:a}))});const $=W([{type:"selection"},x,N,_,q,A,B,C,{key:"actions",title:"Action",fixed:"right",width:"255px",render(t){return l(ae,{snapshot:t,onDelete:c},null)}}]),p=O({page:1,pageSize:50,showSizePicker:!0,pageSizes:[50,100],onChange:t=>{p.page=t},onUpdatePageSize:t=>{p.pageSize=t,p.page=1}});j(p,F);const E=t=>{t.columnKey==x.key&&(x.sortOrder=t.order)},S=w(!1),v=w(""),m=d(async()=>{const t=v.value.trim().split(`
`).map(a=>a.trim()).filter(a=>ie(a));t.length!=0&&(await ce(t),await c(),v.value="")}),r=w([]),h=()=>Promise.all(r.value.map(t=>Z.getItem(t))),M=d(async()=>{await new Promise((t,a)=>{re.warning({title:"删除",content:`是否批量删除 ${r.value.length} 个快照`,negativeText:"取消",positiveText:"确认",onClose:a,onEsc:a,onMaskClick:a,onNegativeClick:a,onPositiveClick:t})}),await Promise.all(r.value.map(t=>Z.removeItem(t))),await c()}),U=d(async()=>{await te(await h())}),D=d(async()=>{await le(await h())}),I=d(async()=>{const t=await oe(await h());T({content:t.map(a=>a.href).join(`
`)+`
`})}),R=d(async()=>{const t=await ne(await h());T({content:t.map(a=>a.href).join(`
`)+`
`})});return(t,a)=>(K(),Q(V,null,[l(e(ue),{show:S.value,"onUpdate:show":a[1]||(a[1]=n=>S.value=n),preset:"dialog",title:"导入网络文件","show-icon":!1,"positive-text":"确认","negative-text":"取消",style:{width:"800px"},onPositiveClick:e(m).invoke,loading:e(m).loading},{default:o(()=>[l(e(L),{value:v.value,"onUpdate:value":a[0]||(a[0]=n=>{e(m).loading||(v.value=n)}),type:"textarea",placeholder:`请输入文件链接
每行一个
空白行自动忽略
非法链接行自动忽略`,autosize:{minRows:8,maxRows:16},"input-props":{style:"white-space: nowrap;"}},null,8,["value"])]),_:1},8,["show","onPositiveClick","loading"]),k("div",me,[k("div",he,[l(e(f),null,{default:o(()=>[l(e(ve),null,{default:o(()=>[l(e(L),{placeholder:"请输入关键字搜索",clearable:"",value:e(u).query,"onUpdate:value":a[2]||(a[2]=n=>e(u).query=n),onKeyup:J(e(u).updateQuery,["enter"]),onChange:e(u).updateQuery},null,8,["value","onKeyup","onChange"]),l(e(s),{onClick:e(u).updateQuery},{default:o(()=>[i(" 搜索 ")]),_:1},8,["onClick"])]),_:1}),r.value.length?(K(),Q(V,{key:0},[l(e(P),null,{trigger:o(()=>[l(e(s),null,{default:o(()=>[i(" 批量下载 ")]),_:1})]),default:o(()=>[l(e(f),{vertical:""},{default:o(()=>[l(e(s),{onClick:e(U).invoke,loading:e(U).loading},{default:o(()=>[i(" 批量下载-png ")]),_:1},8,["onClick","loading"]),l(e(s),{onClick:e(D).invoke,loading:e(D).loading},{default:o(()=>[i(" 批量下载-zip ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1}),l(e(P),null,{trigger:o(()=>[l(e(s),null,{default:o(()=>[i(" 批量分享 ")]),_:1})]),default:o(()=>[l(e(f),{vertical:""},{default:o(()=>[l(e(s),{onClick:e(I).invoke,loading:e(I).loading},{default:o(()=>[i(" 批量生成链接-png ")]),_:1},8,["onClick","loading"]),l(e(s),{onClick:e(R).invoke,loading:e(R).loading},{default:o(()=>[i(" 批量生成链接-zip ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1}),l(e(s),{onClick:e(M).invoke},{default:o(()=>[i(" 批量删除 ")]),_:1},8,["onClick"]),k("div",we,X(`已选中 ${r.value.length} 个快照`),1)],64)):Y("",!0)]),_:1}),ke,l(e(f),null,{default:o(()=>[l(e(P),null,{trigger:o(()=>[l(e(s),null,{default:o(()=>[i(" 导入 ")]),_:1})]),default:o(()=>[l(e(f),{vertical:""},{default:o(()=>[l(e(s),{onClick:e(z).invoke,loading:e(z).loading},{default:o(()=>[i(" 导入本地文件 ")]),_:1},8,["onClick","loading"]),l(e(s),{onClick:a[3]||(a[3]=n=>S.value=!0),loading:e(m).loading},{default:o(()=>[i(" 导入网络文件 ")]),_:1},8,["loading"])]),_:1})]),_:1}),l(e(ee),{to:"/device"},{default:o(()=>[l(e(s),null,{default:o(()=>[i(" 去连接设备 ")]),_:1})]),_:1})]),_:1})]),l(e(fe),{striped:"",data:g.value,columns:$,"scroll-x":1800,pagination:e(p),"checked-row-keys":r.value,"onUpdate:checkedRowKeys":a[4]||(a[4]=n=>r.value=n),"row-key":n=>n.id,"onUpdate:sorter":E,size:"small",class:"flex-1","flex-height":""},null,8,["data","columns","pagination","checked-row-keys","row-key"])])],64))}});export{Ue as default};
//# sourceMappingURL=HomePage-c7d26b6a.js.map
