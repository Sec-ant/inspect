import{at as Q,d as Y,as as ee,c as te,j as F,o as b,aj as _,g as c,f as oe,b as w,n as m,t as ne,u as r,m as g,p as E}from"./index-dedea248.js";import{b as k,h as T,o as j,f as z,i as M,j as N,p as $,e as J,a as S,g as I}from"./storage-ba037a15.js";import{i as ae,a as se,J as C}from"./file_type-7205f6eb.js";import{u as A,a as H,b as B}from"./task-2cb3dacc.js";var V={exports:{}};(function(t,e){(function(s,i){i()})(k,function(){function s(o,n){return typeof n>"u"?n={autoBom:!1}:typeof n!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),n={autoBom:!n}),n.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(o.type)?new Blob(["\uFEFF",o],{type:o.type}):o}function i(o,n,f){var a=new XMLHttpRequest;a.open("GET",o),a.responseType="blob",a.onload=function(){h(a.response,n,f)},a.onerror=function(){console.error("could not download file")},a.send()}function d(o){var n=new XMLHttpRequest;n.open("HEAD",o,!1);try{n.send()}catch{}return 200<=n.status&&299>=n.status}function u(o){try{o.dispatchEvent(new MouseEvent("click"))}catch{var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),o.dispatchEvent(n)}}var l=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof k=="object"&&k.global===k?k:void 0,y=l.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),h=l.saveAs||(typeof window!="object"||window!==l?function(){}:"download"in HTMLAnchorElement.prototype&&!y?function(o,n,f){var a=l.URL||l.webkitURL,p=document.createElement("a");n=n||o.name||"download",p.download=n,p.rel="noopener",typeof o=="string"?(p.href=o,p.origin===location.origin?u(p):d(p.href)?i(o,n,f):u(p,p.target="_blank")):(p.href=a.createObjectURL(o),setTimeout(function(){a.revokeObjectURL(p.href)},4e4),setTimeout(function(){u(p)},0))}:"msSaveOrOpenBlob"in navigator?function(o,n,f){if(n=n||o.name||"download",typeof o!="string")navigator.msSaveOrOpenBlob(s(o,f),n);else if(d(o))i(o,n,f);else{var a=document.createElement("a");a.href=o,a.target="_blank",setTimeout(function(){u(a)})}}:function(o,n,f,a){if(a=a||open("","_blank"),a&&(a.document.title=a.document.body.innerText="downloading..."),typeof o=="string")return i(o,n,f);var p=o.type==="application/octet-stream",W=/constructor/i.test(l.HTMLElement)||l.safari,D=/CriOS\/[\d]+/.test(navigator.userAgent);if((D||p&&W||y)&&typeof FileReader<"u"){var R=new FileReader;R.onloadend=function(){var v=R.result;v=D?v:v.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=v:location=v,a=null},R.readAsDataURL(o)}else{var Z=l.URL||l.webkitURL,U=Z.createObjectURL(o);a?a.location=U:location.href=U,a=null,setTimeout(function(){Z.revokeObjectURL(U)},4e4)}});l.saveAs=h.saveAs=h,t.exports=h})})(V);var x=V.exports;const q="https://github.com/gkd-kit/inspect/issues/new",ie="661952005",P={origin:"https://github.com",referer:q},re=async()=>{var d;const t='[data-upload-policy-url="/upload/policies/assets"] input.js-data-upload-policy-url-csrf',e=await T(q);return(d=new DOMParser().parseFromString(await e.text(),"text/html").querySelector(t))==null?void 0:d.getAttribute("value")},G=async(t,e)=>{const[s,i]=(()=>{if(ae(t))return[e||"file.png","image/png"];if(se(t))return[e||"file.zip","application/x-zip-compressed"];throw new Error("invalid buffer, it must be png or zip")})(),d=await re();if(!d)throw Q.githubErrorDlgVisible=!0,new Error("failed get csrfToken");const u=await T("https://github.com/upload/policies/assets",{method:"POST",body:j({authenticity_token:d,content_type:i,name:s,size:t.byteLength,repository_id:ie}),headers:P}).then(h=>{if(!h.ok)throw new Error("failed upload policies assets");return h.json()});if(!(await T(u.upload_url,{method:"POST",body:j(u.form,{file:new File([t],s,{type:i})}),headers:P})).ok)throw new Error("upload s3 failed");if((await T(new URL(u.asset_upload_url,"https://github.com/").href,{method:"PUT",body:j({authenticity_token:u.asset_upload_authenticity_token}),headers:{...P,Accept:"application/json"}})).status!=200)throw new Error("failed check authenticity upload");return u.asset},L=async t=>{const e=new C;return e.file("snapshot.json",JSON.stringify(t)).file("screenshot.png",await J.getItem(t.id)),await e.generateAsync({type:"blob",compression:"STORE"})},ce=async t=>{const e=`snapshot-${t.id}.zip`;x.saveAs(await L(t),e)},O=async t=>{const e=await J.getItem(t.id);return new Blob([e,JSON.stringify(t)])},le=async t=>{const e=`snapshot-${t.id}.png`;x.saveAs(await O(t),e)},we=async t=>{const e=new C;for(const i of t)await z(),e.file(i.id+".png",O(i));const s=await e.generateAsync({type:"blob",compression:"STORE"});x.saveAs(s,`batch-png-${t.length}.zip`)},me=async t=>{const e=new C;for(const i of t)await z(),e.file(i.id+".zip",await L(i));const s=await e.generateAsync({type:"blob",compression:"STORE"});x.saveAs(s,`batch-zip-${t.length}.zip`)},X=async t=>M[t.id]??G(await O(t).then(e=>e.arrayBuffer())).then(e=>(M[t.id]=e.href,e.href)),K=async t=>N[t.id]??G(await L(t).then(e=>e.arrayBuffer())).then(e=>(N[t.id]=e.href,e.href)),ge=async t=>{const e=$(3);return(await Promise.allSettled(t.map(s=>e(()=>X(s))))).reduce((s,i)=>(i.status=="fulfilled"&&s.push(i.value),s),[])},ye=async t=>{const e=$(3);return(await Promise.allSettled(t.map(s=>e(()=>K(s))))).reduce((s,i)=>(i.status=="fulfilled"&&s.push(i.value),s),[])},pe=["href"],ve=Y({__name:"ActionCard",props:{snapshot:{},onDelete:{type:Function,default:()=>()=>{}},showPreview:{type:Boolean,default:!0},showExport:{type:Boolean,default:!0},showDelete:{type:Boolean,default:!0},showShare:{type:Boolean,default:!0}},setup(t){const e=t,s=ee(),i=A(async()=>le(await S.getItem(e.snapshot.id))),d=A(async()=>ce(await S.getItem(e.snapshot.id))),u=te(()=>s.resolve({name:"snapshot",params:{snapshotId:e.snapshot.id}}).href),l=A(async()=>{const o=await X(await S.getItem(e.snapshot.id));F({title:"分享链接",content:I(o)})}),y=A(async()=>{const o=await K(await S.getItem(e.snapshot.id));F({title:"分享链接",content:I(o)})}),h=async()=>{await S.removeItem(e.snapshot.id),await z(500),e.onDelete()};return(o,n)=>(b(),_(r(B),null,{default:c(()=>[o.showPreview?(b(),oe("a",{key:0,target:"_blank",href:u.value},[w(r(g),{size:"small"},{default:c(()=>[m(ne(o.$t("preview")),1)]),_:1})],8,pe)):E("",!0),o.showExport?(b(),_(r(H),{key:1},{trigger:c(()=>[w(r(g),{size:"small"},{default:c(()=>[m(" 下载 ")]),_:1})]),default:c(()=>[w(r(B),{vertical:""},{default:c(()=>[w(r(g),{onClick:r(i).invoke,loading:r(i).loading},{default:c(()=>[m(" 下载-png ")]),_:1},8,["onClick","loading"]),w(r(g),{onClick:r(d).invoke,loading:r(d).loading},{default:c(()=>[m(" 下载-zip ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1})):E("",!0),o.showShare?(b(),_(r(H),{key:2},{trigger:c(()=>[w(r(g),{size:"small"},{default:c(()=>[m(" 分享 ")]),_:1})]),default:c(()=>[w(r(B),{vertical:""},{default:c(()=>[w(r(g),{onClick:r(l).invoke,loading:r(l).loading},{default:c(()=>[m(" 生成链接-png ")]),_:1},8,["onClick","loading"]),w(r(g),{onClick:r(y).invoke,loading:r(y).loading},{default:c(()=>[m(" 生成链接-zip ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1})):E("",!0),o.showDelete?(b(),_(r(g),{key:3,size:"small",onClick:h},{default:c(()=>[m(" 删除 ")]),_:1})):E("",!0)]),_:1}))}});export{ve as _,me as a,we as b,ge as c,ye as d};
//# sourceMappingURL=ActionCard.vue_vue_type_script_setup_true_lang-05f1b9d0.js.map
