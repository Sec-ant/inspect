import{d as W,as as Q,c as Y,j as F,o as b,aj as _,g as c,f as ee,b as w,n as m,t as te,u as r,m as g,p as A}from"./index-b1304cf0.js";import{b as k,f as x,o as B,e as U,h as M,i as N,p as H,d as $,a as S}from"./storage-4bb66a1a.js";import{i as oe,a as ne,J as z}from"./file_type-5aef3647.js";import{u as E,a as I,b as P}from"./task-fc36cfbd.js";var J={exports:{}};(function(t,e){(function(s,i){i()})(k,function(){function s(o,n){return typeof n>"u"?n={autoBom:!1}:typeof n!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),n={autoBom:!n}),n.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(o.type)?new Blob(["\uFEFF",o],{type:o.type}):o}function i(o,n,f){var a=new XMLHttpRequest;a.open("GET",o),a.responseType="blob",a.onload=function(){h(a.response,n,f)},a.onerror=function(){console.error("could not download file")},a.send()}function d(o){var n=new XMLHttpRequest;n.open("HEAD",o,!1);try{n.send()}catch{}return 200<=n.status&&299>=n.status}function u(o){try{o.dispatchEvent(new MouseEvent("click"))}catch{var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),o.dispatchEvent(n)}}var l=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof k=="object"&&k.global===k?k:void 0,y=l.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),h=l.saveAs||(typeof window!="object"||window!==l?function(){}:"download"in HTMLAnchorElement.prototype&&!y?function(o,n,f){var a=l.URL||l.webkitURL,p=document.createElement("a");n=n||o.name||"download",p.download=n,p.rel="noopener",typeof o=="string"?(p.href=o,p.origin===location.origin?u(p):d(p.href)?i(o,n,f):u(p,p.target="_blank")):(p.href=a.createObjectURL(o),setTimeout(function(){a.revokeObjectURL(p.href)},4e4),setTimeout(function(){u(p)},0))}:"msSaveOrOpenBlob"in navigator?function(o,n,f){if(n=n||o.name||"download",typeof o!="string")navigator.msSaveOrOpenBlob(s(o,f),n);else if(d(o))i(o,n,f);else{var a=document.createElement("a");a.href=o,a.target="_blank",setTimeout(function(){u(a)})}}:function(o,n,f,a){if(a=a||open("","_blank"),a&&(a.document.title=a.document.body.innerText="downloading..."),typeof o=="string")return i(o,n,f);var p=o.type==="application/octet-stream",K=/constructor/i.test(l.HTMLElement)||l.safari,D=/CriOS\/[\d]+/.test(navigator.userAgent);if((D||p&&K||y)&&typeof FileReader<"u"){var T=new FileReader;T.onloadend=function(){var v=T.result;v=D?v:v.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=v:location=v,a=null},T.readAsDataURL(o)}else{var Z=l.URL||l.webkitURL,j=Z.createObjectURL(o);a?a.location=j:location.href=j,a=null,setTimeout(function(){Z.revokeObjectURL(j)},4e4)}});l.saveAs=h.saveAs=h,t.exports=h})})(J);var R=J.exports;const q="https://github.com/gkd-kit/inspect/issues/new",ae="661952005",C={origin:"https://github.com",referer:q},se=async()=>{var d;const t='[data-upload-policy-url="/upload/policies/assets"] input.js-data-upload-policy-url-csrf',e=await x(q,void 0,{gm:!0});return(d=new DOMParser().parseFromString(await e.text(),"text/html").querySelector(t))==null?void 0:d.getAttribute("value")},V=async(t,e)=>{const[s,i]=(()=>{if(oe(t))return[e||"file.png","image/png"];if(ne(t))return[e||"file.zip","application/x-zip-compressed"];throw new Error("invalid buffer, it must be png or zip")})(),d=await se();if(!d)throw new Error("failed get csrfToken");const u=await x("https://github.com/upload/policies/assets",{method:"POST",body:B({authenticity_token:d,content_type:i,name:s,size:t.byteLength,repository_id:ae}),headers:C}).then(h=>{if(!h.ok)throw new Error("failed upload policies assets");return h.json()});if(!(await x(u.upload_url,{method:"POST",body:B(u.form,{file:new File([t],s,{type:i})}),headers:C})).ok)throw new Error("upload s3 failed");if((await x(new URL(u.asset_upload_url,"https://github.com/").href,{method:"PUT",body:B({authenticity_token:u.asset_upload_authenticity_token}),headers:{...C,Accept:"application/json"}})).status!=200)throw new Error("failed check authenticity upload");return u.asset},L=async t=>{const e=new z;return e.file("snapshot.json",JSON.stringify(t)).file("screenshot.png",await $.getItem(t.id)),await e.generateAsync({type:"blob",compression:"STORE"})},ie=async t=>{const e=`snapshot-${t.id}.zip`;R.saveAs(await L(t),e)},O=async t=>{const e=await $.getItem(t.id);return new Blob([e,JSON.stringify(t)])},re=async t=>{const e=`snapshot-${t.id}.png`;R.saveAs(await O(t),e)},fe=async t=>{const e=new z;for(const i of t)await U(),e.file(i.id+".png",O(i));const s=await e.generateAsync({type:"blob",compression:"STORE"});R.saveAs(s,`batch-png-${t.length}.zip`)},he=async t=>{const e=new z;for(const i of t)await U(),e.file(i.id+".zip",await L(i));const s=await e.generateAsync({type:"blob",compression:"STORE"});R.saveAs(s,`batch-zip-${t.length}.zip`)},G=async t=>M[t.id]??V(await O(t).then(e=>e.arrayBuffer())).then(e=>(M[t.id]=structuredClone(e),e)),X=async t=>N[t.id]??V(await L(t).then(e=>e.arrayBuffer())).then(e=>(N[t.id]=structuredClone(e),e)),we=async t=>{const e=H(3);return(await Promise.allSettled(t.map(s=>e(()=>G(s))))).reduce((s,i)=>(i.status=="fulfilled"&&s.push(i.value),s),[])},me=async t=>{const e=H(3);return(await Promise.allSettled(t.map(s=>e(()=>X(s))))).reduce((s,i)=>(i.status=="fulfilled"&&s.push(i.value),s),[])},ce=["href"],ge=W({__name:"ActionCard",props:{snapshot:{},onDelete:{type:Function,default:()=>()=>{}},showPreview:{type:Boolean,default:!0},showExport:{type:Boolean,default:!0},showDelete:{type:Boolean,default:!0},showShare:{type:Boolean,default:!0}},setup(t){const e=t,s=Q(),i=E(async()=>re(await S.getItem(e.snapshot.id))),d=E(async()=>ie(await S.getItem(e.snapshot.id))),u=Y(()=>s.resolve({name:"snapshot",params:{snapshotId:e.snapshot.id}}).href),l=E(async()=>{const o=await G(await S.getItem(e.snapshot.id));F({title:"分享链接",content:o.href+`
`})}),y=E(async()=>{const o=await X(await S.getItem(e.snapshot.id));F({title:"分享链接",content:o.href+`
`})}),h=async()=>{await S.removeItem(e.snapshot.id),await U(500),e.onDelete()};return(o,n)=>(b(),_(r(P),null,{default:c(()=>[o.showPreview?(b(),ee("a",{key:0,target:"_blank",href:u.value},[w(r(g),{size:"small"},{default:c(()=>[m(te(o.$t("preview")),1)]),_:1})],8,ce)):A("",!0),o.showExport?(b(),_(r(I),{key:1},{trigger:c(()=>[w(r(g),{size:"small"},{default:c(()=>[m(" 下载 ")]),_:1})]),default:c(()=>[w(r(P),{vertical:""},{default:c(()=>[w(r(g),{onClick:r(i).invoke,loading:r(i).loading},{default:c(()=>[m(" 下载-png ")]),_:1},8,["onClick","loading"]),w(r(g),{onClick:r(d).invoke,loading:r(d).loading},{default:c(()=>[m(" 下载-zip ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1})):A("",!0),o.showShare?(b(),_(r(I),{key:2},{trigger:c(()=>[w(r(g),{size:"small"},{default:c(()=>[m(" 分享 ")]),_:1})]),default:c(()=>[w(r(P),{vertical:""},{default:c(()=>[w(r(g),{onClick:r(l).invoke,loading:r(l).loading},{default:c(()=>[m(" 生成链接-png ")]),_:1},8,["onClick","loading"]),w(r(g),{onClick:r(y).invoke,loading:r(y).loading},{default:c(()=>[m(" 生成链接-zip ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1})):A("",!0),o.showDelete?(b(),_(r(g),{key:3,size:"small",onClick:h},{default:c(()=>[m(" 删除 ")]),_:1})):A("",!0)]),_:1}))}});export{ge as _,he as a,fe as b,we as c,me as d};
//# sourceMappingURL=ActionCard.vue_vue_type_script_setup_true_lang-640c2280.js.map
